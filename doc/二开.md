### 一、背景
当执行带有子任务的分片任务时，每个片的任务执行完后都会执行子任务，导致子任务重复执行，这与我们的预期不符。

### 二、解决方案及实现
每次任务执行时，生成batchId(批次id)，在redis中保存batchId启动的任务数量。

当任务执行完成后，客户端回调callback接口，最终执行到AdminBizImpl.callback方法，在该逻辑内保存该batchId下成功的任务数量。

当该batchId启动的任务数量与成功的任务数量相等时，表示任务全部执行完毕，可以开启子任务


### 三、配置新增与修改

1. xxl-job-admin配置文件增加如下配置

```properties
### xxl-job, redis
spring.redis.host=127.0.0.1
spring.redis.port=6379
spring.redis.database=10
spring.redis.timeout=5s
spring.redis.connect-timeout=3s
spring.redis.password=xxx
```

2. 数据库修改如下 
```sql
alter table xxl_job_log
    add batch_id varchar(50) null comment '批次id' after job_id;
```



